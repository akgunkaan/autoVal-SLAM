<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoVal SLAM Web Simulator</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">AutoVal SLAM Web Simulator</span>
        </div>
    </nav>

    <main class="container mt-4">
        <div class="row">
            <!-- Controls -->
            <div class="col-lg-4">
                <h3>Controls</h3>
                <div class="card">
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="sim-type" class="form-label">Simulation Type</label>
                            <select id="sim-type" class="form-select">
                                <option value="camera">Camera</option>
                                <option value="lidar">LiDAR</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="frame-count" class="form-label">Frame/Scan Count</label>
                            <input type="number" id="frame-count" class="form-control" value="10">
                        </div>
                        <button id="run-button" class="btn btn-primary w-100">Run Simulation</button>
                    </div>
                </div>

                <hr class="my-4">
                <h3>Map & ODD Controls</h3>
                <div class="card mt-3">
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="weather" class="form-label">Weather Conditions:</label>
                            <select id="weather" class="form-select">
                                <option value="Clear">Clear</option>
                                <option value="Rain">Rain</option>
                                <option value="Snow">Snow</option>
                                <option value="Fog">Fog</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="wind-speed" class="form-label">Wind Speed:</label>
                            <select id="wind-speed" class="form-select">
                                <option value="No">No Wind</option>
                                <option value="Low">Low Wind</option>
                                <option value="Medium">Medium Wind</option>
                                <option value="High">High Wind</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="rainfall-rate" class="form-label">Rainfall:</label>
                            <select id="rainfall-rate" class="form-select">
                                <option value="No">No Rain</option>
                                <option value="Light">Light Rain</option>
                                <option value="Moderate">Moderate Rain</option>
                                <option value="Heavy">Heavy Rain</option>
                                <option value="Violent">Violent Rain</option>
                                <option value="Cloudburst">Cloudburst</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="snowfall-rate" class="form-label">Snowfall:</label>
                            <select id="snowfall-rate" class="form-select">
                                <option value="No">No Snow</option>
                                <option value="Light">Light Snow</option>
                                <option value="Moderate">Moderate Snow</option>
                                <option value="Heavy">Heavy Snow</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="luminosity" class="form-label">Luminosity (Lux):</label>
                            <input type="number" id="luminosity" class="form-control" value="6000" min="0" max="12000">
                        </div>
                        <div class="mb-3">
                            <label for="particulate-type" class="form-label">Particulate Type:</label>
                            <input type="text" id="particulate-type" class="form-control" value="none">
                        </div>
                        <div class="mb-3">
                            <label for="particulate-intensity" class="form-label">Particulate Intensity (0-100):</label>
                            <input type="number" id="particulate-intensity" class="form-control" value="0" min="0" max="100">
                        </div>
                        <div class="mb-3">
                            <p>Vehicle Speed: <span id="speed-display" class="fw-bold">Normal</span></p>
                        </div>
                        <div class="mb-3 d-flex justify-content-around">
                            <button id="add-obstacle-btn" class="btn btn-secondary">Add Obstacle</button>
                            <button id="add-vehicle-btn" class="btn btn-secondary">Add Vehicle</button>
                        </div>
                        <div class="mb-3 d-flex justify-content-around">
                            <button id="change-map-btn" class="btn btn-secondary">Change Map</button>
                            <button id="random-obstacles-btn" class="btn btn-secondary">Add Random Obstacles</button>
                        </div>
                        <div class="mb-3">
                            <button id="export-odd-btn" class="btn btn-info w-100">Export ODD (YAML)</button>
                        </div>

                        <h5 class="card-title mt-3 mb-2 px-3">Simulation Map (50x50px grid)</h5>
                        <div id="map" class="map-grid border border-secondary rounded overflow-hidden p-0">
                            <div id="vehicle" class="map-object vehicle" draggable="true" style="left: 0px; top: 0px;"></div>
                        </div>
                    </div>
                </div>

                <hr class="my-4">
                <h3>Obstacle Avoidance Algorithms</h3>

                <!-- I. Classical Geometric and Field-Based Methods (Legacy Methods) -->
                <div class="card mt-3">
                    <div class="card-header">Classical Geometric and Field-Based Methods</div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-secondary btn-sm" data-category="classical" data-algorithm="APF">Artificial Potential Field (APF)</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="classical" data-algorithm="BugAlgorithms">Bug Algorithms (General)</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="classical" data-algorithm="TangentBug">TangentBug</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="classical" data-algorithm="CBUG">CBUG</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="classical" data-algorithm="VFF">Virtual Force Field (VFF)</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="classical" data-algorithm="VFH">Vector Field Histogram (VFH)</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="classical" data-algorithm="DWA">Dynamic Window Approach (DWA)</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="classical" data-algorithm="CVM">Curvature Velocity Method (CVM)</button>
                        </div>
                    </div>
                </div>

                <!-- II. Reinforcement and Deep Learning-Based Methods (RL/DL/DRL) -->
                <div class="card mt-3">
                    <div class="card-header">Reinforcement and Deep Learning-Based Methods</div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-secondary btn-sm" data-category="rldl" data-algorithm="DRL">Deep Reinforcement Learning (DRL) (General)</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="rldl" data-algorithm="FERO">FERO (Efficient Edge DRL)</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="rldl" data-algorithm="D3QN">Dueling Double Deep Q-Network (D3QN)</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="rldl" data-algorithm="PPO">Proximal Policy Optimization (PPO)</button>
                        </div>
                    </div>
                </div>

                <!-- III. Search, Sampling, and Meta-Heuristic Methods -->
                <div class="card mt-3">
                    <div class="card-header">Search, Sampling, and Meta-Heuristic Methods</div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-secondary btn-sm" data-category="search" data-algorithm="PRM">Probabilistic Roadmap (PRM)</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="search" data-algorithm="RRT">Rapidly-Exploring Random Tree (RRT)</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="search" data-algorithm="ACO">Ant Colony Optimization (ACO)</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="search" data-algorithm="GA">Genetic Algorithms (GA)</button>
                        </div>
                    </div>
                </div>

                <!-- IV. Special Purpose Systems and Modern Architectural Approaches -->
                <div class="card mt-3">
                    <div class="card-header">Special Purpose Systems and Modern Architectural Approaches</div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-secondary btn-sm" data-category="special" data-algorithm="CoDAC">CoDAC (IVO-DWA Integrated)</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="special" data-algorithm="PRMB">Plastic Recurrent Mushroom Body (PRMB)</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="special" data-algorithm="FuzzyLogic">Fuzzy Logic Controller (Agriculture)</button>
                            <button class="btn btn-outline-secondary btn-sm" data-category="special" data-algorithm="MLClassifiers">Multiple ML Classifiers (Voting Classifier)</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Output -->
            <div class="col-lg-8">
                <h3>Output</h3>
                <div id="output-log-container" class="mb-3">
                    <pre id="output-log" class="bg-light p-2 rounded">Initializing... Please wait.</pre>
                </div>
                
                <h3>Visualization</h3>
                <div id="plot-container" class="bg-light rounded text-center">
                    <div id="plot"></div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <h3>Operational Design Domain (ODD) Visualization</h3>
                <div id="odd-visualization-container" class="bg-light p-3 rounded">
                    <!-- ODD visualization will be displayed here -->
                    <pre id="odd-display" class="bg-light p-2 rounded">ODD data will be loaded and visualized here after Pyodide initialization.</pre>
                </div>
            </div>
        </div>
    </main>

    <footer class="text-center mt-4 py-3 bg-light">
        <p>AutoVal SLAM Project</p>
    </footer>

    <script src="main.js"></script>
</body>
</html>
